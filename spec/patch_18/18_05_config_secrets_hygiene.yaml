schema_version: "1.0"
document: "PATCH 18.05 - Config + Secrets Hygiene (Local Override, Sample Config, Git Ignore)"
language: "en"

problem_statement:
  - "appsettings.json currently contains concrete connection strings (even if dev)."
  - "Enterprise deployments require separation of code and secrets (env vars, secret stores)."
  - "Developers still need a convenient local override mechanism."

goals:
  - "Add appsettings.Sample.json (no real secrets)."
  - "Add appsettings.Local.json support (optional, gitignored) for developer machines."
  - "Ensure README clarifies secret injection patterns (env vars / local)."
  - "Strengthen configuration validation where missing."

hard_constraints:
  - "Do not break existing local runs if appsettings.json is still present."
  - "Never commit real secrets in repo by default."
  - "Local override file must be ignored by git."

files_to_modify_or_create:
  modify:
    - path: "src/TILSOFTAI.Api/Program.cs"
    - path: ".gitignore"
    - path: "README.md"
  create:
    - path: "src/TILSOFTAI.Api/appsettings.Sample.json"

implementation_steps:
  - step: "S1 - Program.cs: load appsettings.Local.json"
    detail:
      - "Add: builder.Configuration.AddJsonFile('appsettings.Local.json', optional: true, reloadOnChange: true);"
      - "Ensure it is loaded AFTER appsettings.json so it overrides."
  - step: "S2 - Add appsettings.Sample.json"
    detail:
      - "Include all sections, but set ConnectionString/JwksUrl/etc to placeholders."
      - "Do not include any real server names, user names, or passwords."
  - step: "S3 - Update .gitignore"
    detail:
      - "Add: appsettings.Local.json"
      - "Add: *.Development.local.json (optional pattern) if you use it."
  - step: "S4 - Update README"
    detail:
      - "Document: use environment variables or appsettings.Local.json for secrets."
      - "Show env var mapping examples: Sql__ConnectionString, Auth__JwksUrl, Redis__ConnectionString."
      - "Clarify: appsettings.json is committed as NON-SECRET defaults only."

acceptance_criteria:
  - "Repo contains appsettings.Sample.json with placeholders."
  - "Repo ignores appsettings.Local.json."
  - "Program loads local override file without breaking defaults."
  - "README includes secret injection guidance."
  - "spec/PROGRESS.md updated with Patch 18.05 results."
