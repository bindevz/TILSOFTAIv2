# Progress
# TILSOFTAI Strategy Progress

- [x] spec/strategy/01_solution_structure.yaml
- [x] spec/strategy/02_sql_knowledge_layer.yaml
- [x] spec/strategy/03_tool_contracts_and_registry.yaml
- [x] spec/strategy/04_orchestration_engine.yaml
- [x] spec/strategy/05_atomic_data_engine.yaml
- [x] spec/strategy/06_plan_optimizer_and_atomic_engine.yaml
- [x] spec/strategy/07_redis_semantic_cache.yaml
- [x] spec/strategy/08_human_in_loop_actions.yaml
- [x] spec/strategy/09_recursive_deep_scan.yaml
- [x] spec/strategy/10_proactive_diagnostics.yaml
- [x] spec/strategy/11_contract_sync_and_tests.yaml
- [x] spec/strategy/12_example_module_model.yaml

## Patch Progress

- [x] spec/patch/01_chat_endpoints_wiring.yaml
- [x] spec/patch/02_llm_client_openai.yaml
- [x] spec/patch/03_sql_observability_conversations.yaml
- [x] spec/patch/04_error_codes_and_exception_middleware.yaml
- [x] spec/patch/05_normalization_rules_engine.yaml
- [x] spec/patch/06_atomic_execute_plan_impl.yaml
- [x] spec/patch/07_prompt_budgeting_refactor.yaml
- [x] spec/patch/08_openai_compatible_endpoint.yaml
- [x] spec/patch/09_metadata_dictionary_multilang_fix.yaml
- [x] spec/patch/10_sql_model_module_dedup.yaml
- [x] spec/patch/11_streaming_hardening.yaml
- [x] spec/patch/12_schema_global_override_keys_fix.yaml
- [x] spec/patch/13_openai_streaming_hardening.yaml

## Patch 14 Progress

- [x] spec/patch_14/14_01_cleanup_redundant_files.yaml
- [x] spec/patch_14/14_02_sql_base_tables_and_sps.yaml
- [x] spec/patch_14/14_03_sql_migrations_and_filtered_uniques.yaml
- [x] spec/patch_14/14_04_contract_tests_schema_lint.yaml

## Notes
- 2026-01-27: Implemented platform core foundation (spec content found in `spec/strategy/01_solution_structure.yaml`). Added solution/projects, execution context + middleware, options binding/validation, auth/redis setup, chat endpoints + hub, and updated appsettings. Files: `TILSOFTAI.slnx`, `src/TILSOFTAI.Api/`, `src/TILSOFTAI.Domain/`, `src/TILSOFTAI.Infrastructure/`, `src/TILSOFTAI.Orchestration/`.
- 2026-01-27: Implemented SQL core schema (spec content found in `spec/strategy/02_sql_knowledge_layer`). Added core SQL scripts for tables, SPs, semantic view, and seed data. Files: `sql/01_core/001_tables_core.sql`, `sql/01_core/002_sps_app_core.sql`, `sql/01_core/003_sps_ai_core.sql`, `sql/99_seed/001_seed_metadata_dictionary.sql`, `sql/99_seed/002_seed_toolcatalog_core.sql`.
- 2026-01-27: Implemented tool contracts/registry (spec content found in `spec/strategy/03_api_contracts.yaml`). Added tool definition + registry in orchestration and SQL-backed tool catalog sync in infrastructure. Files: `src/TILSOFTAI.Orchestration/Tools/ToolDefinition.cs`, `src/TILSOFTAI.Orchestration/Tools/IToolRegistry.cs`, `src/TILSOFTAI.Orchestration/Tools/ToolRegistry.cs`, `src/TILSOFTAI.Infrastructure/Tools/ToolCatalogEntry.cs`, `src/TILSOFTAI.Infrastructure/Tools/ToolCatalogSyncService.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Infrastructure/TILSOFTAI.Infrastructure.csproj`.
- 2026-01-27: Implemented orchestration engine scaffold (spec content found in `spec/strategy/04_orchestration_engine.yaml`). Added chat pipeline, prompt builder, LLM contracts, tool governance/validation, tool execution and SQL executor, and null persistence/context services. Files: `src/TILSOFTAI.Orchestration/`, `src/TILSOFTAI.Infrastructure/`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`.
- 2026-01-27: Implemented compaction + token budget policies (spec content found in `spec/strategy/05_atomic_data_engine.yaml`). Added JSON compactor, token budget policy, compaction rules in config, and wired prompt trimming + tool result compaction. Files: `src/TILSOFTAI.Orchestration/Compaction/ToolResultCompactor.cs`, `src/TILSOFTAI.Orchestration/Prompting/TokenBudgetPolicy.cs`, `src/TILSOFTAI.Orchestration/Prompting/PromptBuilder.cs`, `src/TILSOFTAI.Orchestration/Pipeline/ChatPipeline.cs`, `src/TILSOFTAI.Domain/Configuration/CompactionRules.cs`, `src/TILSOFTAI.Domain/Configuration/ChatOptions.cs`, `src/TILSOFTAI.Api/appsettings.json`.
- 2026-01-27: Implemented plan optimizer + atomic data engine (spec content found in `spec/strategy/06_plan_optimizer_and_atomic_engine.yaml`). Added plan validation, atomic engine, atomic catalog provider, SQL catalogs, and atomic SPs. Files: `src/TILSOFTAI.Orchestration/Planning/PlanOptimizer.cs`, `src/TILSOFTAI.Orchestration/Planning/PlanValidationResult.cs`, `src/TILSOFTAI.Orchestration/Atomic/AtomicDataEngine.cs`, `src/TILSOFTAI.Orchestration/Atomic/`, `src/TILSOFTAI.Infrastructure/Atomic/SqlAtomicCatalogProvider.cs`, `src/TILSOFTAI.Infrastructure/Sql/SqlExecutor.cs`, `sql/02_atomic/`.
- 2026-01-27: Implemented Redis semantic cache (spec content found in `spec/strategy/07_redis_semantic_cache.yaml`). Added semantic cache + single-flight guard, cache policy options, chat pipeline cache check, and atomic catalog snapshot caching. Files: `src/TILSOFTAI.Infrastructure/Caching/SemanticCache.cs`, `src/TILSOFTAI.Infrastructure/Caching/SingleFlight.cs`, `src/TILSOFTAI.Orchestration/Caching/ISemanticCache.cs`, `src/TILSOFTAI.Orchestration/Pipeline/ChatPipeline.cs`, `src/TILSOFTAI.Infrastructure/Atomic/SqlAtomicCatalogProvider.cs`, `src/TILSOFTAI.Domain/Configuration/SemanticCacheOptions.cs`, `src/TILSOFTAI.Domain/Configuration/ConfigurationSectionNames.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/appsettings.json`.
- 2026-01-27: Implemented human-in-the-loop actions (spec content found in `spec/strategy/08_human_in_loop_actions.yaml`). Added action request table/SPs, approval service, SQL-backed store, and approve/reject/execute endpoints. Files: `sql/03_actions/001_tables_action.sql`, `sql/03_actions/002_sps_action.sql`, `src/TILSOFTAI.Orchestration/Actions/ActionApprovalService.cs`, `src/TILSOFTAI.Orchestration/Actions/ActionRequestRecord.cs`, `src/TILSOFTAI.Orchestration/Actions/IActionRequestStore.cs`, `src/TILSOFTAI.Orchestration/Actions/ActionExecutionResult.cs`, `src/TILSOFTAI.Infrastructure/Actions/SqlActionRequestStore.cs`, `src/TILSOFTAI.Api/Controllers/ActionsController.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`.
- 2026-01-27: Implemented recursive deep-scan policy enforcement (spec content found in `spec/strategy/09_recursive_deep_scan.yaml`). Added recursion policy and enforced max recursion in the chat pipeline. Files: `src/TILSOFTAI.Orchestration/Policies/RecursionPolicy.cs`, `src/TILSOFTAI.Orchestration/Pipeline/ChatPipeline.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`.
- 2026-01-27: Implemented proactive diagnostics (spec content found in `spec/strategy/10_proactive_diagnostics.yaml`). Added diagnostics rule table/SPs, diagnostics tool handler, tool handler router, and module core project; extended SQL executor for diagnostics. Files: `sql/04_diagnostics/001_tables_diagnostics.sql`, `sql/04_diagnostics/002_sps_diagnostics.sql`, `src/TILSOFTAI.Modules.Core/Tools/DiagnosticsToolHandler.cs`, `src/TILSOFTAI.Api/Tools/ToolHandlerRouter.cs`, `src/TILSOFTAI.Orchestration/Sql/ISqlExecutor.cs`, `src/TILSOFTAI.Infrastructure/Sql/SqlExecutor.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Modules.Core/TILSOFTAI.Modules.Core.csproj`, `TILSOFTAI.slnx`.
- 2026-01-27: Implemented contract sync + tests (spec content found in `spec/strategy/11_contract_sync_and_tests.yaml`). Added runtime SQL contract validator + hosted service, tool handler routing for diagnostics, and contract/integration test projects (tool/SP checks, compaction, cache). Files: `src/TILSOFTAI.Infrastructure/Sql/SqlContractValidator.cs`, `src/TILSOFTAI.Infrastructure/Sql/SqlContractValidatorHostedService.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/Tools/ToolHandlerRouter.cs`, `tests/TILSOFTAI.Tests.Contract/`, `tests/TILSOFTAI.Tests.Integration/`, `TILSOFTAI.slnx`.
- 2026-01-27: Implemented example Model module (spec content found in `spec/strategy/12_example_module_model.yaml`). Added model SQL schema/views/SPs + seed ToolCatalog/MetadataDictionary, module project with tool handlers, module loader registration, named tool handler routing, and enabled module in appsettings. Files: `sql/02_modules/model/`, `sql/99_seed/003_seed_toolcatalog_model.sql`, `sql/99_seed/004_seed_metadata_model.sql`, `src/TILSOFTAI.Modules.Model/`, `src/TILSOFTAI.Orchestration/Modules/ITilsoftModule.cs`, `src/TILSOFTAI.Orchestration/Tools/INamedToolHandlerRegistry.cs`, `src/TILSOFTAI.Orchestration/Tools/NamedToolHandlerRegistry.cs`, `src/TILSOFTAI.Infrastructure/Modules/ModuleLoader.cs`, `src/TILSOFTAI.Api/Tools/ToolHandlerRouter.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/appsettings.json`, `TILSOFTAI.slnx`.
- 2026-01-28: Implemented chat endpoints wiring (spec content found in `spec/patch/01_chat_endpoints_wiring.yaml`). Added chat API contracts, SSE writer, ChatController/ChatHub orchestration wiring, optional exception middleware hook, test auth + endpoint integration tests, and error envelope type. Files: `src/TILSOFTAI.Api/Contracts/Chat/ChatApiRequest.cs`, `src/TILSOFTAI.Api/Contracts/Chat/ChatApiResponse.cs`, `src/TILSOFTAI.Api/Contracts/Chat/ChatStreamEventEnvelope.cs`, `src/TILSOFTAI.Api/Streaming/SseWriter.cs`, `src/TILSOFTAI.Api/Controllers/ChatController.cs`, `src/TILSOFTAI.Api/Hubs/ChatHub.cs`, `src/TILSOFTAI.Api/Extensions/MapTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/Program.cs`, `src/TILSOFTAI.Domain/Errors/ErrorEnvelope.cs`, `tests/TILSOFTAI.Tests.Integration/ChatEndpointTests.cs`, `tests/TILSOFTAI.Tests.Integration/TILSOFTAI.Tests.Integration.csproj`.
- 2026-01-28: Implemented OpenAI-compatible LLM client (spec content found in `spec/patch/02_llm_client_openai.yaml`). Added LLM options/config, OpenAI wire models + parser, OpenAI-compatible client with streaming/tool-call support, DI registration, and parsing unit tests. Files: `src/TILSOFTAI.Domain/Configuration/LlmOptions.cs`, `src/TILSOFTAI.Domain/Configuration/ConfigurationSectionNames.cs`, `src/TILSOFTAI.Infrastructure/Llm/OpenAiWireModels.cs`, `src/TILSOFTAI.Infrastructure/Llm/OpenAiResponseParser.cs`, `src/TILSOFTAI.Infrastructure/Llm/OpenAiCompatibleLlmClient.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/appsettings.json`, `src/TILSOFTAI.Api/appsettings.Development.json`, `src/TILSOFTAI.Infrastructure/TILSOFTAI.Infrastructure.csproj`, `tests/TILSOFTAI.Tests.Integration/OpenAiParsingTests.cs`.
- 2026-01-28: Implemented SQL observability + conversation persistence (spec content found in `spec/patch/03_sql_observability_conversations.yaml`). Added observability tables/SPs, model AI SPs/views, SQL-backed conversation store, and updated model compare handler for JSON array arguments. Files: `sql/01_core/004_tables_observability.sql`, `sql/01_core/005_sps_app_observability.sql`, `sql/05_model/001_views_model.sql`, `sql/05_model/002_sps_ai_model.sql`, `sql/02_modules/model/003_sps_model.sql`, `src/TILSOFTAI.Infrastructure/Conversations/SqlConversationStore.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Modules.Model/Tools/ModelCompareModelsToolHandler.cs`.
- 2026-01-28: Implemented error codes + exception middleware (spec content found in `spec/patch/04_error_codes_and_exception_middleware.yaml`). Added localized error catalog, exception handling middleware, SQL error logging writer, middleware ordering, and controller error flow updates. Files: `src/TILSOFTAI.Domain/Errors/ErrorCode.cs`, `src/TILSOFTAI.Domain/Errors/ErrorDefinition.cs`, `src/TILSOFTAI.Domain/Errors/IErrorCatalog.cs`, `src/TILSOFTAI.Domain/Errors/ISqlErrorLogWriter.cs`, `src/TILSOFTAI.Infrastructure/Errors/InMemoryErrorCatalog.cs`, `src/TILSOFTAI.Infrastructure/Errors/SqlErrorLogWriter.cs`, `src/TILSOFTAI.Api/Middlewares/ExceptionHandlingMiddleware.cs`, `src/TILSOFTAI.Api/Middlewares/ExecutionContextMiddleware.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/Extensions/MapTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/Controllers/ChatController.cs`, `src/TILSOFTAI.Api/Controllers/OpenAiChatCompletionsController.cs`.
- 2026-01-28: Implemented normalization rules engine (spec content found in `spec/patch/05_normalization_rules_engine.yaml`). Added NormalizationRule table/SPs/seed, tenant-aware rule provider, season expansion, cached normalization service, and test overrides. Files: `sql/01_core/006_tables_normalization.sql`, `sql/01_core/007_sps_app_normalization.sql`, `sql/99_seed/005_seed_normalization_rules.sql`, `src/TILSOFTAI.Orchestration/Normalization/NormalizationRuleRecord.cs`, `src/TILSOFTAI.Orchestration/Normalization/INormalizationRuleProvider.cs`, `src/TILSOFTAI.Orchestration/Normalization/SeasonNormalizer.cs`, `src/TILSOFTAI.Orchestration/Normalization/NormalizationService.cs`, `src/TILSOFTAI.Infrastructure/Normalization/SqlNormalizationRuleProvider.cs`, `src/TILSOFTAI.Orchestration/Sql/ISqlExecutor.cs`, `src/TILSOFTAI.Infrastructure/Sql/SqlExecutor.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Orchestration/Pipeline/ChatPipeline.cs`, `src/TILSOFTAI.Domain/Caching/IRedisCacheProvider.cs`, `tests/TILSOFTAI.Tests.Integration/ChatEndpointTests.cs`, `tests/TILSOFTAI.Tests.Integration/CompactionAndCacheTests.cs`.
- 2026-01-28: Implemented ai_atomic_execute_plan (spec content found in `spec/patch/06_atomic_execute_plan_impl.yaml`). Added safe dynamic SQL execution with catalog validation, tenant enforcement, and JSON envelope; updated PlanOptimizer validation for orderBy/where/drilldown. Files: `sql/02_atomic/003_sps_ai_atomic.sql`, `src/TILSOFTAI.Orchestration/Planning/PlanOptimizer.cs`.
- 2026-01-28: Implemented prompt budgeting refactor (spec content found in `spec/patch/07_prompt_budgeting_refactor.yaml`). Simplified system prompt, added prompt budget constants and context pack budgeting, removed prompt truncation, updated token budgeting, and added tests. Files: `src/TILSOFTAI.Orchestration/Prompting/PromptBuilder.cs`, `src/TILSOFTAI.Orchestration/Prompting/TokenBudgetPolicy.cs`, `src/TILSOFTAI.Orchestration/Prompting/PromptBudget.cs`, `src/TILSOFTAI.Orchestration/Prompting/ContextPackBudgeter.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `tests/TILSOFTAI.Tests.Contract/PromptBudgetingTests.cs`.
- 2026-01-28: Implemented OpenAI-compatible chat completions endpoint (spec content found in `spec/patch/08_openai_compatible_endpoint.yaml`). Added OpenAI request/response DTOs, SSE chunk writer, controller mapping to ChatPipeline, and integration tests for stream/non-stream. Files: `src/TILSOFTAI.Api/Contracts/OpenAi/OpenAiChatCompletionsRequest.cs`, `src/TILSOFTAI.Api/Contracts/OpenAi/OpenAiChatCompletionsResponse.cs`, `src/TILSOFTAI.Api/Contracts/OpenAi/OpenAiChatCompletionsStreamChunk.cs`, `src/TILSOFTAI.Api/Streaming/OpenAiSseWriter.cs`, `src/TILSOFTAI.Api/Controllers/OpenAiChatCompletionsController.cs`, `tests/TILSOFTAI.Tests.Integration/OpenAiChatCompletionsTests.cs`.
- 2026-01-28: Implemented metadata dictionary multi-language + tenant override fix (spec content found in `spec/patch/09_metadata_dictionary_multilang_fix.yaml`). Added migration to composite PK, updated app_metadatadictionary_list fallback ordering, updated metadata seeds, added SQL-backed context pack provider, and added SQL fallback tests plus integration test overrides. Files: `sql/01_core/001_tables_core.sql`, `sql/01_core/002_sps_app_core.sql`, `sql/01_core/008_migration_metadata_dictionary_multilang.sql`, `sql/99_seed/001_seed_metadata_dictionary.sql`, `sql/99_seed/004_seed_metadata_model.sql`, `src/TILSOFTAI.Infrastructure/Metadata/MetadataDictionaryContextPackProvider.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `tests/TILSOFTAI.Tests.Contract/MetadataDictionarySqlTests.cs`, `tests/TILSOFTAI.Tests.Integration/ChatEndpointTests.cs`, `tests/TILSOFTAI.Tests.Integration/OpenAiChatCompletionsTests.cs`.
- 2026-01-28: Deduplicated model SQL objects (spec content found in `spec/patch/10_sql_model_module_dedup.yaml`). Canonicalized ai_model_* signatures in module SQL, deprecated legacy sql/05_model scripts, and added contract/integration tests for model SPs and handler parameter wiring. Files: `sql/02_modules/model/003_sps_model.sql`, `sql/05_model/001_views_model.sql`, `sql/05_model/002_sps_ai_model.sql`, `tests/TILSOFTAI.Tests.Contract/SqlContractTests.cs`, `tests/TILSOFTAI.Tests.Integration/ModelCompareModelsToolHandlerTests.cs`, `tests/TILSOFTAI.Tests.Integration/TILSOFTAI.Tests.Integration.csproj`.
- 2026-01-28: Hardened streaming paths (spec content found in `spec/patch/11_streaming_hardening.yaml`). Added bounded stream channel + envelope factory, wired SSE and SignalR to async channel writers with cancellation handling, and added streaming tests plus config options. Files: `src/TILSOFTAI.Api/Streaming/ChatStreamChannel.cs`, `src/TILSOFTAI.Api/Streaming/ChatStreamEnvelopeFactory.cs`, `src/TILSOFTAI.Api/Controllers/ChatController.cs`, `src/TILSOFTAI.Api/Hubs/ChatHub.cs`, `src/TILSOFTAI.Domain/Configuration/StreamingOptions.cs`, `src/TILSOFTAI.Domain/Configuration/ConfigurationSectionNames.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Api/appsettings.json`, `tests/TILSOFTAI.Tests.Integration/ChatStreamChannelTests.cs`, `tests/TILSOFTAI.Tests.Integration/ChatEndpointTests.cs`.
- 2026-01-28: Fixed global override key schema with surrogate PKs (spec content found in `spec/patch/12_schema_global_override_keys_fix.yaml`). Added surrogate-key migrations for MetadataDictionary and NormalizationRule, updated base table definitions, and added SQL override integration tests. Files: `sql/01_core/001_tables_core.sql`, `sql/01_core/006_tables_normalization.sql`, `sql/01_core/008_migration_metadata_dictionary_multilang.sql`, `sql/01_core/009_migration_metadata_dictionary_surrogate_pk.sql`, `sql/01_core/010_migration_normalization_rule_surrogate_pk.sql`, `tests/TILSOFTAI.Tests.Integration/GlobalOverrideSqlTests.cs`.
- 2026-01-28: Hardened OpenAI streaming (spec content found in `spec/patch/13_openai_streaming_hardening.yaml`). Replaced sync-over-async in OpenAI SSE streaming with channel-based writer loop, added OpenAI stream translator, and added burst streaming tests. Files: `src/TILSOFTAI.Api/Controllers/OpenAiChatCompletionsController.cs`, `src/TILSOFTAI.Api/Streaming/OpenAiStreamTranslator.cs`, `tests/TILSOFTAI.Tests.Integration/OpenAiChatCompletionsTests.cs`, `tests/TILSOFTAI.Tests.Integration/OpenAiStreamChannelTests.cs`.
- 2026-01-28: Cleaned redundant migrations (spec content found in `spec/patch_14/14_01_cleanup_redundant_files.yaml`). Removed legacy MetadataDictionary/NormalizationRule migration scripts to enforce a single migration path. Files removed: `sql/01_core/008_migration_metadata_dictionary_multilang.sql`, `sql/01_core/009_migration_metadata_dictionary_surrogate_pk.sql`, `sql/01_core/010_migration_normalization_rule_surrogate_pk.sql`.
- 2026-01-28: Updated base table scripts and diagnostics rule listing (spec content found in `spec/patch_14/14_02_sql_base_tables_and_sps.yaml`). Removed nullable composite PKs and base UQ constraints, added Id identity PKs for DatasetCatalog/DiagnosticsRule, and made diagnostics listing deterministic. Files: `sql/01_core/001_tables_core.sql`, `sql/01_core/006_tables_normalization.sql`, `sql/02_atomic/001_tables_catalog.sql`, `sql/04_diagnostics/001_tables_diagnostics.sql`, `sql/04_diagnostics/002_sps_diagnostics.sql`.
- 2026-01-28: Added universal migrations + filtered unique indexes (spec content found in `spec/patch_14/14_03_sql_migrations_and_filtered_uniques.yaml`). Introduced v4/v2 migrations for metadata dictionary, normalization rules, dataset catalog, and diagnostics rules with duplicate detection and filtered unique indexes. Files: `sql/01_core/008_migration_metadata_dictionary_to_v4.sql`, `sql/01_core/011_migration_normalization_rule_to_v4.sql`, `sql/02_atomic/004_migration_datasetcatalog_to_v2.sql`, `sql/04_diagnostics/003_migration_diagnosticsrule_to_v2.sql`.
- 2026-01-28: Added SQL schema lint contract tests (spec content found in `spec/patch_14/14_04_contract_tests_schema_lint.yaml`). Enforced no nullable PK columns and required filtered unique indexes. Files: `tests/TILSOFTAI.Tests.Contract/SqlSchemaLintTests.cs`.

## Patch Fix (spec/patch_fix/00_master_plan.yaml)
- PATCH_01_Core_Engine_EntryPoint.yaml: DONE - Added `IOrchestrationEngine` contract and `OrchestrationEngine` implementation, rewired chat endpoints/hub to use engine, and moved `ChatPipeline` DI registration into orchestration extension (`src/TILSOFTAI.Orchestration/OrchestrationServiceCollectionExtensions.cs`, `src/TILSOFTAI.Orchestration/IOrchestrationEngine.cs`, `src/TILSOFTAI.Orchestration/OrchestrationEngine.cs`, `src/TILSOFTAI.Api/Controllers/ChatController.cs`, `src/TILSOFTAI.Api/Controllers/OpenAiChatCompletionsController.cs`, `src/TILSOFTAI.Api/Hubs/ChatHub.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `src/TILSOFTAI.Orchestration/TILSOFTAI.Orchestration.csproj`).
- PATCH_02_Security_TenantIsolation.yaml: DONE - Added claim constants + resolver, enforced claims-first tenant/user resolution with anti-spoofing checks, aligned exception context resolution, added header fallback flag in auth options, and added tenant isolation tests (`src/TILSOFTAI.Api/Auth/TilsoftClaims.cs`, `src/TILSOFTAI.Api/Auth/ExecutionContextResolver.cs`, `src/TILSOFTAI.Api/Middlewares/ExecutionContextMiddleware.cs`, `src/TILSOFTAI.Api/Middlewares/ExceptionHandlingMiddleware.cs`, `src/TILSOFTAI.Domain/Configuration/AuthOptions.cs`, `tests/TILSOFTAI.Tests.Integration/TenantIsolationTests.cs`, `tests/TILSOFTAI.Tests.Integration/ChatEndpointTests.cs`, `tests/TILSOFTAI.Tests.Integration/OpenAiChatCompletionsTests.cs`).
- PATCH_03_Strict_JsonSchemaValidation.yaml: DONE - Added real JSON Schema validator with cached schemas, switched DI to use it, and added schema validation tests based on model tool schemas (`src/TILSOFTAI.Orchestration/Tools/RealJsonSchemaValidator.cs`, `src/TILSOFTAI.Orchestration/TILSOFTAI.Orchestration.csproj`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`, `tests/TILSOFTAI.Tests.Contract/Validation/JsonSchemaValidatorTests.cs`, `tests/TILSOFTAI.Tests.Contract/TILSOFTAI.Tests.Contract.csproj`).
- PATCH_04_Observability_SQL_Conversation_Error.yaml: DONE - Added observability indexes for tool executions and error codes plus retention guidance (`sql/01_core/004_tables_observability.sql`, `docs/observability_retention.md`).
- PATCH_05_I18N_EndToEnd.yaml: DONE - Added tool catalog translations with vi/en seed data, localized tool validation messages, and wrapped streaming errors with structured localized payloads (`sql/01_core/001_tables_core.sql`, `sql/01_core/002_sps_app_core.sql`, `sql/99_seed/002_seed_toolcatalog_core.sql`, `sql/99_seed/003_seed_toolcatalog_model.sql`, `src/TILSOFTAI.Infrastructure/Tools/ToolCatalogSyncService.cs`, `src/TILSOFTAI.Orchestration/Tools/ToolGovernance.cs`, `src/TILSOFTAI.Orchestration/Tools/ToolValidationLocalizer.cs`, `src/TILSOFTAI.Api/Streaming/ChatStreamEnvelopeFactory.cs`, `src/TILSOFTAI.Api/Controllers/ChatController.cs`, `src/TILSOFTAI.Api/Controllers/OpenAiChatCompletionsController.cs`, `src/TILSOFTAI.Api/Hubs/ChatHub.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`).
- PATCH_06_SQL2025_JSON_VECTOR.yaml: DONE - Added SQL 2025 JSON migration with computed JSON indexes, introduced SemanticCache VECTOR table + ai_semantic_cache_get/put stored procedures, and wired optional SQL vector cache toggle in SemanticCache (`sql/01_core/010_migration_sql2025_json.sql`, `sql/06_semantic/001_tables_semantic_cache.sql`, `sql/06_semantic/002_sps_ai_semantic_cache.sql`, `src/TILSOFTAI.Domain/Configuration/SemanticCacheOptions.cs`, `src/TILSOFTAI.Api/appsettings.json`, `src/TILSOFTAI.Infrastructure/Caching/SemanticCache.cs`, `tests/TILSOFTAI.Tests.Integration/CompactionAndCacheTests.cs`).
- PATCH_07_AtomicTool_Wiring.yaml: DONE - Seeded atomic_execute_plan tool with schema + translations and added handler routing via AtomicDataEngine (plan validation) (`sql/99_seed/002_seed_toolcatalog_core.sql`, `src/TILSOFTAI.Api/Tools/AtomicExecutePlanToolHandler.cs`, `src/TILSOFTAI.Api/Extensions/AddTilsoftAiExtensions.cs`).
- PATCH_08_Model_Module_RealSchema.yaml: DONE - Added enterprise model views/SPs and new tooling (packaging/count), updated model tool instructions, and demoted demo module scripts (`sql/02_modules/model_enterprise/001_views_model_enterprise.sql`, `sql/02_modules/model_enterprise/002_sps_model_enterprise.sql`, `sql/02_modules/model/001_tables_model.sql`, `sql/02_modules/model/002_views_model.sql`, `sql/02_modules/model/003_sps_model.sql`, `sql/99_seed/003_seed_toolcatalog_model.sql`, `src/TILSOFTAI.Modules.Model/ModelModule.cs`, `src/TILSOFTAI.Modules.Model/Tools/ModelGetPackagingToolHandler.cs`, `src/TILSOFTAI.Modules.Model/Tools/ModelCountToolHandler.cs`).
- PATCH_09_Model_Seeds_and_Glossary.yaml: DONE - Added dev-only model seed scripts and documented dev seeds in README (`sql/98_dev_seeds/model/001_seed_model_demo.sql`, `sql/98_dev_seeds/model/002_seed_metadata_dictionary_model.sql`, `README.md`).
- PATCH_10_Module_Template_Extensibility.yaml: DONE - Added module template docs reference and starter SQL template folder (`README.md`, `sql/90_template_module/README.md`, `sql/90_template_module/001_views_template.sql`, `sql/90_template_module/002_sps_ai_template.sql`).
