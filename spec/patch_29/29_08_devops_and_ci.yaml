# File: PATCH_PACK_29/29_08_devops_and_ci.yaml
patch_pack: 29
pack_id: "29_08"
title: "DevOps Hygiene: Remove Hardcoded Credentials + CI Gates for SQL/Artifacts"
priority: "P2"
goal:
  - "Eliminate insecure deploy scripts; enforce artifact completeness in CI."

tasks:
  - id: "29_08_T01"
    summary: "Deprecate deploy-sql.ps1 or convert to safe sample using env vars"
    files:
      - path: "deploy-sql.ps1"
        diff_intent: >
          Remove hardcoded sa/password and absolute paths.
          Use environment variables + relative paths; add clear 'SAMPLE ONLY' banner if kept.
    acceptance_criteria:
      - "No credentials in repo."
    checklist:
      - "[ ] Grep for 'sa'/'password' secrets; remove."

  - id: "29_08_T02"
    summary: "Add CI gate verifying required SQL modules/procs compile"
    files:
      - path: ".github/workflows/ci.yml"
        diff_intent: >
          Add step:
          - verify required paths exist (analytics module + seeds)
          - run migrations/SQL compile smoke test on ephemeral DB (or at least lint)
    acceptance_criteria:
      - "CI fails if analytics SQL module missing or does not compile."

exit_gate:
  - "Repo is deploy-safe and CI prevents missing-module regressions."
